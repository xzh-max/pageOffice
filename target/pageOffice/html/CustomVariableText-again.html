<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新增自定义变量</title>
    <style>
        /*html {
            !*隐藏滚动条，当IE下溢出，仍然可以滚动*!
            -ms-overflow-style:none;
            !*火狐下隐藏滚动条*!
            overflow:-moz-scrollbars-none;
        }
        !*Chrome下隐藏滚动条，溢出可以透明滚动*!
        html::-webkit-scrollbar{width:0px}*/
        *{
            padding: 0;
            margin: 0;
        }
        .newly-added{
            top: 0%;
            left: 0%;
            width: 100%;
            height: 100%;
        }
        .newly-added-title{
            position: absolute;
            top: 0;
            left: 0;
            width: 25rem;
            min-height: 28.9375rem;
            background-color: white;
        }

        .custom-variables{
            width: 100%;
            height: 2.5rem;
            background: linear-gradient(to right,#5DC1F7,#1E8DE7);
        }
        .custom-variables p{
            font-family: "Microsoft YaHei UI";
            font-size: 0.875rem;
            color: #ffffff;
            line-height: 2.5rem;
            font-weight: bold;
            float: left;
            margin-left: 0.9375rem;
        }
        .variables-content input{
            width: 23.125rem;
            height: 2.5rem;
            border: 1px solid #979797;
            border-radius: 0.1875rem;
            box-sizing: border-box;
            float: left;
            margin-left: 0.9375rem;
            margin-top: 0.3125rem;
            padding-left: 0.9375rem;
            line-height: 2.5rem;
        }
        .variables-bottom input{
            width: 23.125rem;
            height: 2.5rem;
            border: 1px solid #979797;
            border-radius: 0.1875rem;
            box-sizing: border-box;
            float: left;
            margin-left: 0.9375rem;
            margin-top: 0.3125rem;
            padding-left: 0.9375rem;
            line-height: 2.5rem;
        }
        .list input{
            width: 0.9375rem;
            height: 0.9375rem;
            margin-top: 0.75rem;
            margin-left: 1.0625rem;
            padding-left: 0.9375rem;
            line-height: 2.5rem;
        }
        /*.option-content::-webkit-scrollbar{
            display: none;
        }*/
        .variable:focus{
            border: 1px solid #1E8DE7;
        }
        .variable{
            padding-left: 0.625rem;
        }
        .option-text{
            padding: 0.625rem 0.625rem;
            width:21.875rem;height: 3.75rem;
            float: left;margin-left: 0.9375rem;
            border-radius: 0.1875rem;
            margin-top: 0.1875rem;
            border:1px solid #979797;
            box-sizing: border-box;font-size: 0.875rem;
            font-family: 'Microsoft YaHei UI';
            color: #48484A;overflow: hidden
        }
        .option-text:focus{
            border: 1px solid #1E8DE7;
        }
        .cutex{
            width: 1.25rem;
            height: 1.25rem;
            float:right;
            margin-right:1.25rem;
            background: url(../image/delete.png) no-repeat center center;
            background-size: 1.25rem 1.25rem;
            cursor: pointer;
            border-radius: 50%;
        }
        .cutex:hover{
            background-color: #f5f5f5;
        }
        .new-options{
            width: 23.125rem;height: 2.5rem;
            float: left;font-family: 'Microsoft YaHei UI';
            box-sizing: border-box;
            border: 1px solid #1E8DE7;
            font-size: 0.875rem;color: #1E8DE7;
            margin-left: 0.9375rem;margin-top: 0.9375rem;
            text-align: center;line-height: 2.5rem;
            border-radius: 0.1875rem;cursor: pointer;
            background: url(../image/newly-added-icon.png) no-repeat 8.75rem center;
            background-size: 0.8125rem 0.8125rem;
            padding-left: 0.625rem;margin-bottom: 1.25rem;
        }
        .new-options:hover{
            background: #1E8DE7 url("../image/add-white.png") no-repeat 8.75rem center;
            background-size: 0.8125rem 0.8125rem;
            color: #FFFFff;
            padding-left: 0.625rem;
        }
    </style>

    <!--引入jquery-->
    <script src="../js/jquery.min.js"></script>
    <script src="../js/getpath.js"></script>
    <script type="text/javascript">
        var path=getpath();
        var fid = localStorage.getItem("fid");
        var sname ="";
        window.onload = function () {
            //重置按钮
            $(".cancel").click(function () {
                $(".variable").val("");
                // $(".sizelength").val("");
                $(".option-content").html("");
                $(".spanagainCVT").css("display","none");
                $(".spanagain").css("display","none");
                $(".spanone").css("display","none");
                // $(".spannum").css("display","none");
                count = 0;
                $(".openbtn").attr("disabled", true);
                $(".openbtn").css("background-color","#5E6173");
            });

        };


        //输入框失焦事件
        function variableFoucse() {
            var report=$(".variable").val();
            //变量名内容
            var reportItem =trim(report);
            var byId = document.getElementById("select-pid");
            var index2 = byId.selectedIndex;
            //变量类型
            var text = byId.options[index2].text;

            //数字框内容
            // var val = $(".sizelength").val();
            // var sizelength = isRealNum(trim(val));
            //获取变量类型判断变量类型
            //变量类型等于数字时
            // if(text=="数字"){
            //     //先判断变量名称是否为空为空
            //     if(reportItem =='' || reportItem ==null){
            //         $(".spanagainCVT").css("display","none");
            //         $(".spanagain").css("display","none");
            //         $(".spanone").css("display","block");
            //         $(".openbtn").attr("disabled", true);
            //         $(".openbtn").css("background-color","#5E6173");
            //         //名字为空，判断数字是否也为空
            //         if(sizelength =="" || sizelength == null) {
            //             $(".spannum").css("display", "block");
            //         }else {
            //             $(".spannum").css("display", "none");
            //         }
            //         //变量名不为空
            //     } else {
            //         // alert("不为空")
            //         //判断名称是否重复
            //         sname = encodeURI(reportItem);
            //         //变量名称不为空，查看是否重名
            //         $.ajax({
            //             url: "" + path + "/queryByNameAndFid.do?fid=" + fid + "&name=" + sname,
            //             type: "POST",
            //             contentType: "application/json",
            //             data: {},
            //             success: function (data) {
            //                 if (data != "") {
            //                     // alert("data");
            //                     //变量名有值
            //                     if (data.paramType == undefined) {
            //                         // alert("没有匹配数据")
            //                         //没有找到变量名说明变量名不重复，可用
            //                         //主数据中查找变量名有没有和条款名重复
            //                         var dataAeticle = localStorage.getItem("dataAll");
            //                         var dataAs = JSON.parse(dataAeticle)
            //                         if (dataAs.articleInfoDtos == "") {
            //                             //没有条款值
            //                             if (sizelength == "" || sizelength == null) {
            //                                 // alert("空");
            //                                 //数字为空
            //                                 $(".spanagainCVT").css("display", "none");
            //                                 $(".spanone").css("display", "none");
            //                                 $(".spanagain").css("display", "none");
            //                                 $(".spannum").css("display", "block");
            //                                 $(".openbtn").attr("disabled", true);
            //                                 $(".openbtn").css("background-color", "#5E6173");
            //                                 return;
            //                             } else {
            //                                 //数字不为空
            //                                 $(".spanagainCVT").css("display", "none");
            //                                 $(".spanagain").css("display", "none");
            //                                 $(".spanone").css("display", "none");
            //                                 $(".spannum").css("display", "none");
            //                                 $(".openbtn").attr("disabled", false);
            //                                 $(".openbtn").css("background-color", "#1E8DE7");
            //                             }
            //                         } else {
            //                             // alert("有值");
            //                             //有值，判断是否有重名
            //                             for (var i = 0; i < dataAs.articleInfoDtos.length; i++) {
            //                                 if (dataAs.articleInfoDtos[i].name == reportItem) {
            //                                     //有重名
            //                                     // alert("有重名");
            //                                     $(".spanagainCVT").css("display", "block");
            //                                     $(".spanagain").css("display", "none");
            //                                     $(".spanone").css("display", "none");
            //                                     $(".openbtn").attr("disabled", true);
            //                                     $(".openbtn").css("background-color", "#5E6173");
            //                                     return;
            //                                 } else {
            //                                     //没重名
            //                                     //判断数字是否为空
            //                                     if (sizelength == "" || sizelength == null) {
            //                                         // alert("空");
            //                                         //数字为空
            //                                         $(".spanagainCVT").css("display", "none");
            //                                         $(".spanone").css("display", "none");
            //                                         $(".spanagain").css("display", "none");
            //                                         $(".spannum").css("display", "block");
            //                                         $(".openbtn").attr("disabled", true);
            //                                         $(".openbtn").css("background-color", "#5E6173");
            //                                         return;
            //                                     } else {
            //                                         //数字不为空
            //                                         $(".spanagainCVT").css("display", "none");
            //                                         $(".spanagain").css("display", "none");
            //                                         $(".spanone").css("display", "none");
            //                                         $(".spannum").css("display", "none");
            //                                         $(".openbtn").attr("disabled", false);
            //                                         $(".openbtn").css("background-color", "#1E8DE7");
            //                                     }
            //                                 }
            //                             }
            //                         }
            //                     } else {
            //                             //找到变量名说明变量名重复，不可用
            //                             $(".spanagainCVT").css("display", "none");
            //                             $(".spanagain").css("display", "block");
            //                             $(".spanone").css("display", "none");
            //                             $(".openbtn").attr("disabled", true);
            //                             $(".openbtn").css("background-color", "#5E6173");
            //                             //判断数字是否为空
            //                             if (sizelength == "" || sizelength == null) {
            //                                 $(".spannum").css("display", "block");
            //                             } else {
            //                                 $(".spannum").css("display", "none");
            //                             }
            //                         }
            //                     } else {
            //                     //变量名没值
            //                         $(".spanagainCVT").css("display", "none");
            //                         $(".spanagain").css("display", "none");
            //                         $(".spanone").css("display", "none");
            //                         $(".spannum").css("display", "none");
            //                         $(".openbtn").attr("disabled", false);
            //                         $(".openbtn").css("background-color", "#1E8DE7");
            //                     }
            //                 }
            //         })
            //
            //     }
            // }

            //变量类型等于下拉选项时
            if(text=="下拉选项"){
                //先判断变量名是否为空
                if(reportItem =='' || reportItem ==null){
                    //为空
                    $(".spanagainCVT").css("display", "none");
                    $(".spanagain").css("display","none");
                    $(".spanone").css("display","block");
                    $(".openbtn").attr("disabled", true);
                    $(".openbtn").css("background-color","#5E6173");
                }else {
                    //不为空
                    //判断值是否重复
                    sname = encodeURI(reportItem);
                    $.ajax({
                        url:""+path+"/queryByNameAndFid.do?fid="+fid+"&name="+sname,
                        type:"POST",
                        contentType: "application/json",
                        data:{},
                        success:function (data) {
                            //判断返回的变量值是否为空
                            if(data != ""){
                                if(data.paramType == undefined){
                                    //没有找到变量名说明变量名不重复，可用
                                    //主数据中查找变量名有没有和条款名重复
                                    var dataAeticle = localStorage.getItem("dataAll");
                                    var dataAs = JSON.parse(dataAeticle);
                                    //判断
                                    if(dataAs.articleInfoDtos == ""){
                                        $(".spanagainCVT").css("display","none");
                                        $(".spanagain").css("display","none");
                                        $(".spanone").css("display","none");
                                        $(".openbtn").attr("disabled", false);
                                        $(".openbtn").css("background-color","#1E8DE7");
                                        funchoose();
                                    }else {
                                        //有重名
                                        for( var i =0 ;i<dataAs.articleInfoDtos.length; i++){
                                            if(dataAs.articleInfoDtos[i].name == reportItem){
                                                $(".spanagainCVT").css("display", "block");
                                                $(".spanagain").css("display", "none");
                                                $(".spanone").css("display", "none");
                                                $(".openbtn").attr("disabled", true);
                                                $(".openbtn").css("background-color", "#5E6173");
                                                return;
                                            }else {
                                                $(".spanagainCVT").css("display","none");
                                                $(".spanagain").css("display","none");
                                                $(".spanone").css("display","none");
                                                $(".openbtn").attr("disabled", false);
                                                $(".openbtn").css("background-color","#1E8DE7");
                                                funchoose();
                                            }
                                        }
                                    }
                                }else {
                                    //找到变量名说明变量名重复，不可用
                                    $(".spanagainCVT").css("display","none");
                                    $(".spanagain").css("display","block");
                                    $(".spanone").css("display","none");
                                    $(".openbtn").attr("disabled", true);
                                    $(".openbtn").css("background-color","#5E6173");
                                }
                            }else {
                                $(".spanagainCVT").css("display","none");
                                $(".spanagain").css("display","none");
                                $(".spanone").css("display","none");
                                $(".openbtn").attr("disabled", false);
                                $(".openbtn").css("background-color","#1E8DE7");
                            }
                        }
                    })
                }
            }
            //变量类型等于其他类型时
            else {
                //变量名称为空
                if(reportItem =='' || reportItem ==null){
                    $(".spanagainCVT").css("display", "none");
                    $(".spanagain").css("display","none");
                    $(".spanone").css("display","block");
                    $(".openbtn").attr("disabled", true);
                    $(".openbtn").css("background-color","#5E6173");
                }else {
                    //变量名称不为空，查看是否重名
                    sname = encodeURI(reportItem);

                    $.ajax({
                        url:""+path+"/queryByNameAndFid.do?fid="+fid+"&name="+sname,
                        type:"POST",
                        contentType: "application/json",
                        data:{},
                        success:function (data) {
                            //判断返回的变量值是否为空
                            if(data != ""){
                                if(data.paramType == undefined){
                                    //没有找到变量名说明变量名不重复，可用
                                    //主数据中查找变量名有没有和条款名重复
                                    var dataAeticle = localStorage.getItem("dataAll");
                                    var dataAs = JSON.parse(dataAeticle);
                                    //判断
                                    if(dataAs.articleInfoDtos == ""){
                                        $(".spanagainCVT").css("display","none");
                                        $(".spanagain").css("display","none");
                                        $(".spanone").css("display","none");
                                        $(".openbtn").attr("disabled", false);
                                        $(".openbtn").css("background-color","#1E8DE7");
                                    }else {
                                        //有重名
                                        for( var i =0 ;i<dataAs.articleInfoDtos.length; i++){
                                            if(dataAs.articleInfoDtos[i].name == reportItem){
                                                $(".spanagainCVT").css("display", "block");
                                                $(".spanagain").css("display", "none");
                                                $(".spanone").css("display", "none");
                                                $(".openbtn").attr("disabled", true);
                                                $(".openbtn").css("background-color", "#5E6173");
                                                return;
                                            }else {
                                                $(".spanagainCVT").css("display","none");
                                                $(".spanagain").css("display","none");
                                                $(".spanone").css("display","none");
                                                $(".openbtn").attr("disabled", false);
                                                $(".openbtn").css("background-color","#1E8DE7");
                                            }
                                        }
                                    }
                                }else {
                                    //找到变量名说明变量名重复，不可用
                                    $(".spanagainCVT").css("display","none");
                                    $(".spanagain").css("display","block");
                                    $(".spanone").css("display","none");
                                    $(".openbtn").attr("disabled", true);
                                    $(".openbtn").css("background-color","#5E6173");
                                }
                            }else {
                                $(".spanagainCVT").css("display","none");
                                $(".spanagain").css("display","none");
                                $(".spanone").css("display","none");
                                $(".openbtn").attr("disabled", false);
                                $(".openbtn").css("background-color","#1E8DE7");
                            }
                        }
                    })
                }
            }
        }


        //下拉框选中时触发
        function funchoose(){
            var byId = document.getElementById("select-pid");
            var index2 = byId.selectedIndex;
            //变量类型
            var text = byId.options[index2].text;
            if(text=="下拉选项"){
                //下拉框
                $('#select-pid').css('margin-bottom','10px');
                $(".numlength").css('display', 'none');
                $('#getoption').css('display', 'block');

                var count = 0 ;
                if($(".option-text").val() == undefined || trim($(".option-text").val()) == "" || $(".option-content").html() == null || trim($('.variable').val()) == ''){
                    $(".spanagainCVT").css("display", "none");
                    $(".spanagain").css("display", "none");
                    $(".spanone").css("display", "none");
                    $(".openbtn").attr("disabled", true);
                    $(".openbtn").css("background-color","#5E6173");
                    return;
                }else {
                    var len = $('.option-content').children('.option-list').length;
                    for(var i = 0; i < len; i++){
                        if(trim($('.option-list').eq(i).children('.option-text').val()) == ""){
                            count++
                            $(".spanagainCVT").css("display", "none");
                            $(".spanagain").css("display", "none");
                            $(".spanone").css("display", "none");
                            $(".openbtn").attr("disabled", true);
                            $(".openbtn").css("background-color","#5E6173");
                            return;
                        }
                    }

                    //变量名内容
                    var report=$(".variable").val();
                    var reportItem =trim(report);
                    sname = encodeURI(reportItem);
                    var param = false;
                    //判断名字是否重复
                    $.ajax({
                        url:""+path+"/queryByNameAndFid.do?fid="+fid+"&name="+sname,
                        type:"POST",
                        contentType: "application/json",
                        data:{},
                        success:function (data) {
                            if(data != ""){
                                if(data.paramType == undefined){
                                    //变量名没找到
                                    // alert("不重名")
                                    //主数据中查找变量名有没有和条款名重复
                                    var dataAeticle = localStorage.getItem("dataAll");
                                    var dataAs = JSON.parse(dataAeticle);
                                    if(dataAs.articleInfoDtos == "") {
                                        $(".spanagainCVT").css("display", "none");
                                        $(".spanagain").css("display", "none");
                                        $(".spanone").css("display", "none");
                                        $(".openbtn").attr("disabled", false);
                                        $(".openbtn").css("background-color", "#1E8DE7");
                                        param = false
                                        return;
                                    }else {
                                        //有重名
                                        for( var i =0 ;i<dataAs.articleInfoDtos.length; i++){
                                            if(dataAs.articleInfoDtos[i].name == sname){
                                                // alert("重复")
                                                $(".spanagainCVT").css("display", "block");
                                                $(".spanagain").css("display", "none");
                                                $(".spanone").css("display", "none");
                                                $(".openbtn").attr("disabled", true);
                                                $(".openbtn").css("background-color", "#5E6173");
                                                param = false;
                                                return;
                                            }else {
                                                // alert("不重复")
                                                //判断下拉选项输入框的值
                                                if ($('#option-content').html() == '') {
                                                    $(".spanagainCVT").css("display", "none");
                                                    $(".spanone").css("display", "none");
                                                    $(".spanagain").css("display", "none");
                                                    $(".openbtn").attr("disabled", true);
                                                    $(".openbtn").css("background-color", "#5E6173");
                                                    param = false;
                                                    return;
                                                } else {
                                                    if ($('.option-text').val() == '') {
                                                        $(".spanagainCVT").css("display", "none");
                                                        $(".spanone").css("display", "none");
                                                        $(".spanagain").css("display", "none");
                                                        $(".openbtn").attr("disabled", true);
                                                        $(".openbtn").css("background-color", "#5E6173");
                                                        param = false;
                                                        return;
                                                    } else {
                                                        $(".spanagainCVT").css("display", "none");
                                                        $(".spanone").css("display", "none");
                                                        $(".spanagain").css("display", "none");
                                                        $(".openbtn").attr("disabled", false);
                                                        $(".openbtn").css("background-color", "#1E8DE7");
                                                        param = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    param = true;
                                }else {
                                    //变量名找到
                                    $(".spanagainCVT").css("display","none");
                                    $(".spanone").css("display","none");
                                    $(".spanagain").css("display","block");
                                    $(".openbtn").attr("disabled", true);
                                    $(".openbtn").css("background-color","#5E6173");
                                    param = false;
                                }
                            }else {
                                $(".spanagainCVT").css("display", "none");
                                $(".spanone").css("display", "none");
                                $(".spanagain").css("display", "none");
                                $(".openbtn").attr("disabled", false);
                                $(".openbtn").css("background-color", "#1E8DE7");
                                param = true;
                            }
                        }
                    });
                    if(count == 0 && param == true){
                        $(".openbtn").attr("disabled", false);
                        $(".openbtn").css("background-color","#1E8DE7");
                    }else if (count != 0 && param == false) {
                        $(".openbtn").attr("disabled", true);
                        $(".openbtn").css("background-color","#5E6173");
                    }
                }
            }else{

                $('#select-pid').css('margin-bottom','180px');
                $('.confirm').css('margin-top','10px');
                if( $(".variable").val() !=''){

                    var report=$(".variable").val();
                    var reportItem =trim(report);
                    sname = encodeURI(reportItem);
                    $.ajax({
                        url:""+path+"/queryByNameAndFid.do?fid="+fid+"&name="+sname,
                        type:"POST",
                        contentType: "application/json",
                        data:{},
                        success:function (data) {
                            //判断返回的变量值是否为空
                            if(data != ""){
                                if(data.paramType == undefined){
                                    //没有找到变量名说明变量名不重复，可用
                                    //主数据中查找变量名有没有和条款名重复
                                    var dataAeticle = localStorage.getItem("dataAll");
                                    var dataAs = JSON.parse(dataAeticle);
                                    //判断
                                    if(dataAs.articleInfoDtos == ""){
                                        $(".spanagainCVT").css("display","none");
                                        $(".spanagain").css("display","none");
                                        $(".spanone").css("display","none");
                                        $(".openbtn").attr("disabled", false);
                                        $(".openbtn").css("background-color","#1E8DE7");
                                    }else {
                                        //有重名
                                        for( var i =0 ;i<dataAs.articleInfoDtos.length; i++){
                                            if(dataAs.articleInfoDtos[i].name == reportItem){
                                                $(".spanagainCVT").css("display", "block");
                                                $(".spanagain").css("display", "none");
                                                $(".spanone").css("display", "none");
                                                $(".openbtn").attr("disabled", true);
                                                $(".openbtn").css("background-color", "#5E6173");
                                                return;
                                            }else {
                                                $(".spanagainCVT").css("display","none");
                                                $(".spanagain").css("display","none");
                                                $(".spanone").css("display","none");
                                                $(".openbtn").attr("disabled", false);
                                                $(".openbtn").css("background-color","#1E8DE7");
                                            }
                                        }
                                    }
                                }else {
                                    //找到变量名说明变量名重复，不可用
                                    $(".spanagainCVT").css("display","none");
                                    $(".spanagain").css("display","block");
                                    $(".spanone").css("display","none");
                                    $(".openbtn").attr("disabled", true);
                                    $(".openbtn").css("background-color","#5E6173");
                                }
                            }else {
                                $(".spanagainCVT").css("display","none");
                                $(".spanagain").css("display","none");
                                $(".spanone").css("display","none");
                                $(".openbtn").attr("disabled", false);
                                $(".openbtn").css("background-color","#1E8DE7");
                            }
                        }
                    })

                }else{
                    $(".spanagainCVT").css("display", "none");
                    $(".spanagain").css("display","none");
                    $(".spanone").css("display","block");
                    $(".openbtn").attr("disabled", true);
                    $(".openbtn").css("background-color","#5E6173");
                }
                $('#getoption').css('display', 'none');
                $(".numlength").css("display","none");
            }
        }

        //判断内容是否为数字
        // function isRealNum(val){
        //     // isNaN()函数 把空串 空格 以及NUll 按照0来处理 所以先去除
        //     if(val == "" || val == null){
        //         return false;
        //     }else {
        //         if(!isNaN(val)){
        //             return true;
        //         }else{
        //             return false;
        //         }
        //     }
        //     //
        //     // var p1 = /[^\d\.]/g;	// 过滤非数字及小数点 /g :所有范围中过滤
        //     // var p2 = /(\.\d{6})\d*$/g;
        //     // var p4 = /(\.)(\d*)\1/g;
        //     // val.value = obj.value.replace(p1, "").replace(p2, "$1").replace(p4,"$1$2");
        //     //
        //     //
        //     // val.value=obj.value.replace(/[^0-9.]/g, '');
        //     //
        //     //
        //     // // fix bug: many char'.'
        //     // var p5 = /\.+/g;	//多个点的话只取1个点，屏蔽1....234的情况
        //     // obj.value = obj.value.replace(p5, ".")
        //     //
        //     // var p6 = /(\.+)(\d+)(\.+)/g; //屏蔽1....234.的情况
        //     // obj.value = obj.value.replace(p6, "$1$2")// 屏蔽最后一位的.
        //
        // }

        //去掉左边空格
        function ltrim(s) {
            return s.replace(/(^\s*)/g, '');
        }
        //去掉右边空格
        function rtrim(s) {
            return s.replace(/(\s*$)/g, '');
        }
        //去掉左右空格
        function trim(s){
            return rtrim(ltrim(s));
        }



        //新增下拉选项
        var count =1;
        function newxx() {
            count++;
            $(".option-content").append("<div class='option-list'; style=\"width: 100%;overflow: hidden;margin-top: 0.9375rem\">\n" +
                "<p style=\"font-family: 'Microsoft YaHei UI';font-size: 0.875rem;color: #48484A;float:left;\n" +
                "margin-left:0.9375rem;margin-top: 0px;\">选项</p><span style=\"float: left;margin-top: 0px;margin-left: 2px;\n" +
                "font-family:'Microsoft YaHei UI';font-size: 1rem;color:#E51C23;\">*</span>" +
                "<div id='delex" + count + "'; vlaue='" + count + "'; class=\"cutex\" onclick=\"delexl('delex"+count+"')\"></div>\n" +
                "<textarea class=\"option-text\" oninput='changeCount()'></textarea></div>");
            $(".option-text:last").focus();
            funchoose();
        }
        // 按钮删除选中条框
        function delexl (id) {
            $('#'+id).parents('.option-list').remove();
            funchoose();
        }


        //下拉选项输入框失焦
        function changeCount(){
            funchoose()
        }


        //自定义变量确认按钮
        function variablend() {
            //变量长度
            // var sizelength;
            //变量名
            var name = $(".variable").val();


            var byId = document.getElementById("select-pid");
            var index2 = byId.selectedIndex;
            //变量类型
            var text = byId.options[index2].text;

            //获取下拉框
            var options = document.getElementsByClassName("option-text");

            //获取下拉框值集合写入值
            var option_value = new Array();
            for (var i = 0; i <options.length ; i++) {
                option_value.push(options[i].value)
            }


            //保存新增
            if(text=="下拉选项"){
                //把下拉框值写入
                var optionValues = option_value;
                var jsonArray =[];
                for (var i = 0; i <optionValues.length ; i++) {
                    var jsonObject={};
                    jsonObject.foptionValue =optionValues[i];
                    jsonArray.push(jsonObject);
                }
                var XZData=JSON.stringify({
                    "fid":fid,
                    "entry":{
                        "name":name,
                        "type":text,
                        "length":"",
                        "paramType":3
                    },
                    "options":jsonArray,
                });
            }else {
                var XZData=JSON.stringify({
                    "fid":fid,
                    "entry":{
                        "name":name,
                        "type":text,
                        "length":"",
                        "paramType":2
                    },
                    "options":"",
                })
            };

            $.ajax({
                url:""+path+"/addParam.do",
                type:"POST",
                contentType: "application/json;charset=UTF-8",
                data:XZData,
                success : function(data) {
                    window.external.CallParentFunc("ready");
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    // alert(XMLHttpRequest.status)
                }
            });



            $(".variable").val("");
            $(".option-content").html("");
            funchoose();
            $(".spanone").css("display","none");
        }
    </script>
</head>
<body>
<!--新增的自定义变量弹出框-->
<div id="fade" class="newly-added" style="overflow: hidden;width: 100%;height: 100%" >
    <div class="newly-added-title">
        <div class="custom-variables">
            <p>自定义变量</p>
            <!--            <div id="close" class="custom-variables-close" style="width: 0.875rem; height: 0.875rem;float: right;-->
            <!--background: url(../image/close-button.png) no-repeat center center;margin-right: 0.9375rem;margin-top: 0.75rem;-->
            <!--background-size: 100% 100%;cursor: pointer;"></div>-->
        </div>
        <div class="variables-content" style="width: 100%;height: 6.875rem;">
            <p style="font-family: 'Microsoft YaHei UI';font-size: 0.875rem;color: #48484A;float: left;
margin-left: 0.9375rem;margin-top: 0.9375rem;">变量名称</p><span style="float: left;margin-top: 1rem;margin-left: 2px;
font-family: 'Microsoft YaHei UI';font-size: 1rem;color: #E51C23;">*</span>
            <input type="text" class="variable" oninput="variableFoucse()">
            <div style="min-height: 1.5rem;width: 100%;overflow: hidden;">
                <span class="spanone" style="float: left;display: block;font-size: 0.75rem;width: 100%;margin-left: 0.9375rem;
margin-top: 0.3125rem;color: #E51C23;display: none">提示：变量名称不能为空</span>
                <span class="spanagain" style="float: left;display: block;font-size: 0.75rem;width: 100%;margin-left: 0.9375rem;
margin-top: 0.3125rem;color: #E51C23;display: none">提示：变量名称重复</span>
                <span class="spanagainCVT" style="float: left;display: block;font-size: 0.75rem;width: 100%;margin-left: 0.9375rem;
margin-top: 0.3125rem;color: #E51C23;display: none">提示：名称与条款名重复</span>
                <span class="spanagainOption" style="float: left;display: block;font-size: 0.75rem;width: 100%;margin-left: 0.9375rem;
margin-top: 0.3125rem;color: #E51C23;display: none">提示：名称与条款名重复</span>
            </div>
        </div>

        <div id="text" class="variables-bottom" style="width: 100%;height: 24.125rem;">
            <p style="font-family: 'Microsoft YaHei UI';font-size: 0.875rem;color: #48484A;float: left;
margin-left: 0.9375rem;margin-top: 0.75rem;">类型</p><span style="float: left;margin-top: 0.5rem;margin-left: 2px;
font-family: 'Microsoft YaHei UI';font-size: 1rem;color: #E51C23;">*</span>
            <select style="width: 23.125rem;height: 1.875rem;float: left;box-sizing: border-box;border-radius: 0.1875rem;padding-left: 0.625rem;
border: 0px solid #F2F3F7; background-color: #F2F3F7;margin-left: 0.9375rem;margin-top: 0.375rem;margin-bottom: 11.8125rem;"id="select-pid" onchange="funchoose()">
                <option value="text" style="padding-left: 0.625rem">文字</option>
                <option value="num" style="padding-left: 0.625rem">数字</option>
                <option value="data" style="padding-left: 0.625rem">日期</option>
                <option value="getoption" style="padding-left: 0.625rem">下拉选项</option>
            </select>
            <!--            <div class = "numlength" style="display: none" >-->
            <!--            <p style="font-family: 'Microsoft YaHei UI';font-size: 0.875rem;color: #48484A;float: left;-->
            <!--margin-left: 0.9375rem;margin-top: 0.9375rem;">字段最大长度</p><span style="float: left;margin-top: 16px;margin-left: 2px;-->
            <!--font-family: 'Microsoft YaHei UI';font-size: 16px;color: #E51C23;">*</span>-->
            <!--            <input type="number" class="sizelength"  onblur="variableFoucse()"/><span style="float: left;margin-top: 16px;margin-left: 2px;-->
            <!--font-family: 'Microsoft YaHei UI';font-size: 16px;color: #E51C23;">*</span>-->
            <!--            <div class="spannum" style="float: left;display: block;font-size: 0.75rem;width: 100%;margin-left: 0.9375rem;-->
            <!--margin-top: 0.3125rem;color: #E51C23; display: none">提示：请输入数字</div>-->
            <!--            </div>-->
            <p style="font-family: 'Microsoft YaHei UI';font-size: 0.875rem;color: #48484A;float: left;
margin-left: 0.9375rem;margin-top: 0.9375rem;display: none;">是否必填</p>
            <div class="list" style=" float:left;width: 100%;height: 2.5rem; display: none">
                <input type="checkbox" name="choosevariables" onclick="choosevariable(this)" value="是">
                <p style="float: left;font-family: 'Microsoft YaHei UI';font-size: 0.875rem;color: #48484A;
margin-left: 0.4375rem;margin-top: 0.625rem;margin-right: 6.875rem;">是</p>
                <input type="checkbox" name="choosevariables" onclick="choosevariable(this)" value="否">
                <p style="float: left;font-family: 'Microsoft YaHei UI';font-size: 0.875rem;color: #48484A;
margin-left: 0.4375rem;margin-top: 0.625rem">否</p>
            </div>

            <div id="getoption" class="newly-top" style="display: none;">
                <div class="option-content" style="width: 100%;height: 9.5rem;overflow-y: scroll;">
                    <div class='option-list'; style="width: 100%;overflow: hidden;margin-top: 0.1875rem">
                        <p style="font-family:'Microsoft YaHei UI';font-size: 0.875rem;color: #48484A;float:left;margin-left:0.9375rem;margin-top: 0px;">选项</p>
                        <span style="float:left;margin-top: 0px;margin-left: 2px;font-family:'Microsoft YaHei UI';font-size: 1rem;color:#E51C23;">*</span>
                        <div id='delex1'; vlaue='1'; class="cutex" style='' onclick="delexl('delex1')"></div>
                        <textarea class="option-text" oninput='changeCount()' autofocus="autofocus"></textarea></div>
                </div>
                <div class="new-options" onclick="newxx()">新增选项</div>
            </div><!--自定义变量选项内容-->
            <div class="confirm" style="width: 100%; height: 2.5rem;float: left;padding-bottom: 1.875rem;border-top: 1px solid #d4d0c8;margin-top: 1.25rem;position: absolute;bottom: 1px;background: #fff;">
                <p class="openbtn" style="display: inline-block;width: 4.75rem;height: 1.5625rem;float: left;background-color: #5E6173;/*#1E8DE7;*/
font-family: 'Microsoft YaHei UI';font-size: 0.75rem;color: #ffffff;text-align: center;line-height: 1.5625rem;
margin-left: 7.5rem;margin-top: 1.5rem;border-radius: 0.1875rem;cursor: pointer" disabled="true" onclick="variablend()">确定</p>
                <span class="cancel" style="display: inline-block;width: 4.75rem;height: 1.5625rem;float: left;background-color: #F2F3F7;
font-family: 'Microsoft YaHei UI';font-size: 0.75rem;color: #5E6173;text-align: center;line-height: 1.5625rem;
margin-left: 1.0625rem;margin-top: 1.5rem;border-radius: 0.1875rem; cursor: pointer">重置</span>
            </div>
        </div>

    </div>
</div>  <!--自定义变量弹出框-->
</body>
</html>